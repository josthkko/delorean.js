(function(){var y;if(_.isUndefined(Date.prototype.setISO8601))Date.prototype.setISO8601=function(a){var g,j,a=a.match(RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?"));j=0;g=new Date(a[1],0,1);a[3]&&g.setMonth(a[3]-1);a[5]&&g.setDate(a[5]);a[7]&&g.setHours(a[7]);a[8]&&g.setMinutes(a[8]);a[10]&&g.setSeconds(a[10]);a[12]&&g.setMilliseconds(Number("0."+a[12])*1E3);a[14]&&(j=Number(a[16])*60+Number(a[17]),j*=a[15]===
"-"?1:-1);j-=g.getTimezoneOffset();return this.setTime(Number(Number(g)+j*6E4))};if(_.isUndefined(Date.prototype.toISOString))Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"};if(_.isUndefined(Number.prototype.toPaddedString))Number.prototype.toPaddedString=function(a,
g){var j;j=this.toString(g||10);return"0".times(a-j.length)+j};if(_.isUndefined(Date.prototype.strftime))Date.prototype.strftime=function(){var a,g,j,l,q,m,u,o,k,c,d,e,f,h;l=function(b){return b.getDate()+""};m=function(b){return((b.getTime()-j.start_of_year.getTime())/q+1+"").split(/\./)[0]};k=function(b){k=b.getHours();k===0?k=12:k>12&&(k-=12);return k+""};c=function(b){return b.getHours()};d=function(b){return b.getHours()>=12?"pm":"am"};h=function(b){return b.getFullYear()+""};j={start_of_year:new Date("Jan 1 "+
(new Date).getFullYear())};f=/%([a-z]|%)/g;q=864E5;u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];e=["January","February","March","April","May","June","July","August","September","October","November","December"];a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];o={a:function(b){return a[b.getDay()]},A:function(b){return u[b.getDay()]},b:function(b){return g[b.getMonth()]},B:function(b){return e[b.getMonth()]},
c:function(b){return b.toLocaleString()},d:function(b){return("0"+l(b)).slice(-2)},e:l,H:function(b){return("0"+c(b)).slice(-2)},I:function(b){return("0"+k(b)).slice(-2)},j:m,k:c,l:k,m:function(b){return("0"+(b.getMonth()+1)).slice(-2)},M:function(b){return("0"+b.getMinutes()).slice(-2)},p:function(b){return d(b).toUpperCase()},P:d,S:function(b){return("0"+b.getSeconds()).slice(-2)},U:function(b){return("0"+Math.round(parseInt(m(b),10)/7)).slice(-2)},w:function(b){return b.getDay()+""},x:function(b){return b.toLocaleDateString()},
X:function(b){return b.toLocaleTimeString()},y:function(b){return h(b).slice(-2)},Y:h,z:function(b){b=b.getTimezoneOffset();return(b>=0?"-":"")+("0"+b/60).slice(-2)+":"+("0"+b%60).slice(-2)},"%":function(){return"%"}};return function(b){var c,a;a=b;for(j.start_of_year=new Date("Jan 1 "+this.getFullYear());c=f.exec(b);)c[1]in o&&(a=a.replace(RegExp(c[0],"mg"),o[c[1]](this)));return a}}();y=function(a){var g,j,l,q,m,u,o,k,a={line_colors:["#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],line_labels:[],
date_format:"%m/%d",height:200,width:700,label_display_count:3,label_offset:15,margin_left:5,margin_bottom:5,margin_top:5,text_date:{fill:"#999","font-size":"10px"},text_metric:{"font-size":"13px","font-family":"Arial, san-serif"},trend:!1,grid_color:"#f5f5f5",display_x_grid:!0,display_y_grid:!0,stroke_width:4,stroke_width_dense:2,point_size:5,point_size_hover:7,enable_tooltips:!1,verify_libraries:!0};q=function(){return window.console&&console.log(Array.prototype.slice.call(arguments))};m=function(c){var a;
a=_.isDate(c)?c:new Date(c);isNaN(a)&&(q("ISO 8601 Date constructor not supported in this browser."),a=new Date,a.setISO8601(c));return a};g=function(c){var d,c=m(c).strftime(a.date_format);d=r.text(0,0,c).attr(a.text_date);c=Math.round(d.getBBox().width+22.5);d.remove();return c};j=function(c,a){return c>=0&&c<1E3?c.toString():c>=1E3&&c<1E6?(c/1E3).toFixed(a)+"K":(c/1E6).toFixed(a)+"M"};k=function(a,d){var e,f,h,b,i,n;$("#tooltip").length?$("#tooltip_inner").html(d.join("<br />")):$("body").append('<div id="tooltip"><div id="tooltip_inner">'+
d.join("<br />")+"</div></div>");e=$(a.target.parentNode);h=e.offset().left+e.outerWidth();b=e.offset().top+e.outerHeight();k=$("#tooltip").show();$("#tooltip_inner");e=a.pageX;f=a.pageY;i=k.outerWidth();n=k.outerHeight();return k.css({top:f+n>b?f-n/2:f,left:e+i+20>h?e-i-15:e+20})};o=function(a){var d,e,f,h,b;a.length>6&&(a=a.substring(1,a.length));d=parseInt(a,16);e=Math.abs((d>>16&255)+v);a=Math.abs((d>>8&255)+v);d=Math.abs((d&255)+v);e=e>255?e-(e-255):e;a=a>255?a-(a-255):a;d=d>255?d-(d-255):d;
e=Number(e<0||isNaN(e))?0:(f=e>255)!=null?f:{255:e};a=Number(a<0||isNaN(a))?0:(h=a>255)!=null?h:{255:a};d=Number(d<0||isNaN(d))?0:(b=d>255)!=null?b:{255:d};return"#"+e.toPaddedString(2)+a.toPaddedString(2)+d.toPaddedString(2)};u=function(c){var d;d=a.line_colors[c];_.isUndefined(d)&&(d=c%a.line_colors.length,d=a.line_colors[d],d=o(d,Math.round(c/a.line_colors.length)+50));return d};l=function(c,d){var e,f,h,b,i,n;if(_.isNull(h)||d===!0)h={},n=_.clone(c),f=_(n).keys(),i=Math.round(a.width/17),b=f.length>=
i?Math.round(f.length/i):1,e=[],i=b===1?f.length:i-1,_(i).times(function(a){return e[a]=f.splice(0,b)}),_.each(e,function(a){var b,c;c=_.map(a,function(a){return n[a]});_.isArray(c[0])?(b=[],_(c[0].length).times(function(a){var d;d=_.map(c,function(b){return b[a]});return b.push(Math.round(_(d).reduce(function(a,b){return a+b},0)/d.length))})):b=Math.round(_(c).reduce(function(a,b){return a+b},0)/c.length);a=_.map(a,function(a){return m(a)});a=_(a).chain().sort(function(a,b){return a>b?1:a<b?-1:0}).head().value();
return h[a.toISOString()]=b});return h};Raphael.fn.drawXAxis=function(c,d){var e,f,h,b,i,n,j;e=c.length;n=a.height-8;f=g(c[0]);h=Math.round(e/Math.round(a.width/f));f=h===0?c:_.select(c,function(a,b){return b%h===0});b=f.length;for(j=[];b--;)i=Math.round(d*_.indexOf(c,f[b],!0))+(a.label_offset+15),e=m(f[b]).strftime(a.date_format),this.text(i,n,e).attr(a.text_date).toBack(),j.push(a.display_x_grid?this.path(["M",i,n,"V",0]).attr({stroke:a.grid_color}).toBack():void 0);return j};Raphael.fn.drawYAxis=
function(c){var d,e,f,h,b,i,n,g,k;d=a.label_display_count+1;f=c*1.33;e=c/d;h=a.label_offset;g=Math.round((a.height-a.margin_bottom-a.margin_top)/d);b=g*d;i=0;for(k=[];i<f;){if(d>=1&&i>0){if(a.display_y_grid)for(c=0;c<=1;)n=c===1?b+g/2:b,this.path(["M",h,n,"H",a.width-5]).attr({stroke:a.grid_color}).toBack(),d===1&&c===1&&this.path(["M",h,b-g/2,"H",a.width-5]).attr({stroke:a.grid_color}).toBack(),c++;this.text(h,b,j(Math.round(i),0)).attr({fill:a.text_date.fill,"font-weight":"bold"}).toFront()}b-=
g;d--;k.push(i+=e)}return k};Raphael.fn.drawChart=function(c,d){var e,f,h,b,i,g,j,l,s,m,o,t,q,w,p,x;j=[];e=_(data).keys();w=_(data).values();l=a.margin_bottom;t=e.length>45?a.stroke_width_dense:a.stroke_width;i=0;for(g=w[0].length;i<g;)j[i]=this.path().attr({stroke:u(i),"stroke-width":t,"stroke-linejoin":"round"}),i++;i=this.set();g=[];t=[];e=e.length;h=0;for(x=[];h<e;){p=Math.round(c*h)+(a.label_offset+15);g[p]=[];t[p]=[];m=a.point_size;o=a.point_size_hover;f=h===0;e>45&&e<=90?(m=3,o=5):e>90&&(m=
0,o=3);for(b=0;b<w[h].length;){q=w[h][b];s=Math.round(a.height-l-d*q);q<0&&(s=Math.round(a.height-l-d*0));if(e<=45)j[b][f?"moveTo":"cplineTo"](p,s,10);else if(e<=90)j[b][f?"moveTo":"cplineTo"](p,s,4);else j[b][f?"moveTo":"cplineTo"](p,s,1);s=this.circle(p,s,m).attr({fill:a.line_colors[b],stroke:"#fff"});s.insertAfter(j[b]);g[p].push(s);t[p].push(q);b++}i.push(this.rect(p,0,c,a.height-l).attr({stroke:"none",fill:"#fff",opacity:0}));(function(b,c,d,e){return b.hover(function(){return _.each(c[d],function(a){return a.attr({r:o})})},
function(){_.each(c[d],function(a){return a.attr({r:m})});return $("#tooltip").hide()}).mousemove(function(b){if(a.enable_tooltips)return k(b,e[d])})})(i[i.length-1],g,p,t);x.push(h++)}return x};return{init:function(c,d,e){$.extend(!0,a,e);d=_.clone(d);a.trend===!0&&l(d,!0);if(a.verify_libraries){if(_.isUndefined(Date.prototype.strftime)||_.isUndefined(Date.prototype.setISO8601))throw"You must include the strftime.js file before executing Delorean.js";if(_.isUndefined(Raphael))throw"You must include the raphael.js file before executing Delorean.js";
if(_.isUndefined(Raphael.el.lineTo))throw"You must include the raphael.path.methods.js file before executing Delorean.js";}c=$(c);c.children().remove();return Raphael(c.get(0),a.width,a.height)},distill:function(a){return l(a)},render:function(){var c,d,e,f;e=_(data).keys();c=_(data).values();_.isArray(c[0])?f=_(_(c).flatten()).max():(f=_(c).max(),_.each(data,function(a,b){return data[b]=[a]}));c=(a.width-(a.label_offset+15))/e.length;d=(a.height-a.margin_bottom-a.margin_top)/f;r.drawXAxis(e,c);r.drawChart(c,
d);return r.drawYAxis(f)}}};$.delorean=function(a,g,j){var l;l=new y;l.init(a,g,j);return l}}).call(this);
