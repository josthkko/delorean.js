(function(){if(_.isUndefined(Date.prototype.setISO8601))Date.prototype.setISO8601=function(e){var g,f,e=e.match(RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?"));f=0;g=new Date(e[1],0,1);e[3]&&g.setMonth(e[3]-1);e[5]&&g.setDate(e[5]);e[7]&&g.setHours(e[7]);e[8]&&g.setMinutes(e[8]);e[10]&&g.setSeconds(e[10]);e[12]&&g.setMilliseconds(Number("0."+e[12])*1E3);e[14]&&(f=Number(e[16])*60+Number(e[17]),f*=e[15]==="-"?1:
-1);f-=g.getTimezoneOffset();return this.setTime(Number(Number(g)+f*6E4))};if(_.isUndefined(Date.prototype.toISOString))Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"};if(_.isUndefined(Number.prototype.toPaddedString))Number.prototype.toPaddedString=function(e,g){var f;
f=this.toString(g||10);return"0".times(e-f.length)+f};if(_.isUndefined(Date.prototype.strftime))Date.prototype.strftime=function(){var e,g,f,b,t,n,m,o,l,u,q,c,v,d;b=function(a){return a.getDate()+""};n=function(a){return((a.getTime()-f.start_of_year.getTime())/t+1+"").split(/\./)[0]};l=function(a){l=a.getHours();l===0?l=12:l>12&&(l-=12);return l+""};u=function(a){return a.getHours()};q=function(a){return a.getHours()>=12?"pm":"am"};d=function(a){return a.getFullYear()+""};f={start_of_year:new Date("Jan 1 "+
(new Date).getFullYear())};v=/%([a-z]|%)/g;t=864E5;m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];c=["January","February","March","April","May","June","July","August","September","October","November","December"];e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];o={a:function(a){return e[a.getDay()]},A:function(a){return m[a.getDay()]},b:function(a){return g[a.getMonth()]},B:function(a){return c[a.getMonth()]},
c:function(a){return a.toLocaleString()},d:function(a){return("0"+b(a)).slice(-2)},e:b,H:function(a){return("0"+u(a)).slice(-2)},I:function(a){return("0"+l(a)).slice(-2)},j:n,k:u,l:l,m:function(a){return("0"+(a.getMonth()+1)).slice(-2)},M:function(a){return("0"+a.getMinutes()).slice(-2)},p:function(a){return q(a).toUpperCase()},P:q,S:function(a){return("0"+a.getSeconds()).slice(-2)},U:function(a){return("0"+Math.round(parseInt(n(a),10)/7)).slice(-2)},w:function(a){return a.getDay()+""},x:function(a){return a.toLocaleDateString()},
X:function(a){return a.toLocaleTimeString()},y:function(a){return d(a).slice(-2)},Y:d,z:function(a){a=a.getTimezoneOffset();return(a>=0?"-":"")+("0"+a/60).slice(-2)+":"+("0"+a%60).slice(-2)},"%":function(){return"%"}};return function(a){var c,b;b=a;for(f.start_of_year=new Date("Jan 1 "+this.getFullYear());c=v.exec(a);)c[1]in o&&(b=b.replace(RegExp(c[0],"mg"),o[c[1]](this)));return b}}();(function(e,g){var f;f=function(b){var f,n,m,o,l,u,q,b={line_colors:["#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],
line_labels:[],date_format:"%m/%d",width:700,height:200,label_display_count:3,label_offset:15,margin_left:5,margin_bottom:5,margin_top:5,text_date:{fill:"#999","font-size":"10px"},text_metric:{"font-size":"13px","font-family":"Arial, san-serif"},trend:!1,grid_color:"#f5f5f5",display_x_grid:!0,display_y_grid:!0,stroke_width:4,stroke_width_dense:2,point_size:5,point_size_hover:7,enable_tooltips:!1,verify_libraries:!0};o=function(){return g.console&&console.log(Array.prototype.slice.call(arguments))};
l=function(c){var b;b=_.isDate(c)?c:new Date(c);isNaN(b)&&(o("ISO 8601 Date constructor not supported in this browser."),b=new Date,b.setISO8601(c));return b};f=function(c){var v,c=l(c).strftime(b.date_format);v=r.text(0,0,c).attr(b.text_date);c=Math.round(v.getBBox().width+22.5);v.remove();return c};n=function(c,b){if(c>=0&&c<1E3)return c.toString();else if(c>=1E3&&c<1E6)return(c/1E3).toFixed(b)+"K";else if(c>=1E6)return(c/1E6).toFixed(b)+"M"};q=function(c,b){var d,a,k,i,h,j;e("#tooltip").length?
e("#tooltip_inner").html(b.join("<br />")):e("body").append('<div id="tooltip"><div id="tooltip_inner">'+b.join("<br />")+"</div></div>");d=e(c.target.parentNode);k=d.offset().left+d.outerWidth();i=d.offset().top+d.outerHeight();q=e("#tooltip").show();e("#tooltip_inner");d=c.pageX;a=c.pageY;h=q.outerWidth();j=q.outerHeight();return q.css({top:a+j>i?a-j/2:a,left:d+h+20>k?d-h-15:d+20})};u=function(c,b){var d,a;c.length>6&&(c=c.substring(1,c.length));a=[parseInt(c.slice(0,2),16),parseInt(c.slice(2,4),
16),parseInt(c.slice(4),16)];b=[];for(d=0;d<3;)b[d]=Math.round(a[d]*NaN),b[d]>255&&(b[d]=255),b[d]<0&&(b[d]=0),d++;return"#"+b.join("")};m=function(c,e){var d,a,k,i,h,j;if(_.isNull(k)||e===!0)k={},j=_.clone(c),a=_(j).keys(),h=Math.round(b.width/17),i=a.length>=h?Math.round(a.length/h):1,d=[],h=i===1?a.length:h-1,_(h).times(function(b){return d[b]=a.splice(0,i)}),_.each(d,function(a){var b,c;c=_.map(a,function(a){return j[a]});_.isArray(c[0])?(b=[],_(c[0].length).times(function(a){var d;d=_.map(c,
function(b){return b[a]});return b.push(Math.round(_(d).reduce(function(a,b){return a+b},0)/d.length))})):b=Math.round(_(c).reduce(function(a,b){return a+b},0)/c.length);a=_.map(a,function(a){return l(a)});a=_(a).chain().sort(function(a,b){return a>b?1:a<b?-1:0}).head().value();return k[a.toISOString()]=b});return k};Raphael.fn.drawXAxis=function(c,e){var d,a,k,i,h,j,g;d=c.length;j=b.height-8;a=f(c[0]);k=Math.round(d/Math.round(b.width/a));a=k===0?c:_.select(c,function(a,b){return b%k===0});i=a.length;
for(g=[];i--;)h=Math.round(e*_.indexOf(c,a[i],!0))+(b.label_offset+15),d=l(a[i]).strftime(b.date_format),this.text(h,j,d).attr(b.text_date).toBack(),g.push(b.display_x_grid?this.path(["M",h,j,"V",0]).attr({stroke:b.grid_color}).toBack():void 0);return g};Raphael.fn.drawYAxis=function(c){var e,d,a,k,i,h,j,g,f;e=b.label_display_count+1;a=c*1.33;d=c/e;k=b.label_offset;g=Math.round((b.height-b.margin_bottom-b.margin_top)/e);i=g*e;h=0;for(f=[];h<a;){if(e>=1&&h>0){if(b.display_y_grid)for(c=0;c<=1;)j=c===
1?i+g/2:i,this.path(["M",k,j,"H",b.width-5]).attr({stroke:b.grid_color}).toBack(),e===1&&c===1&&this.path(["M",k,i-g/2,"H",b.width-5]).attr({stroke:b.grid_color}).toBack(),c++;this.text(k,i,n(Math.round(h),0)).attr({fill:b.text_date.fill,"font-weight":"bold"}).toFront()}i-=g;e--;f.push(h+=d)}return f};Raphael.fn.drawChart=function(c,g){var d,a,k,i,h,j,f,l,m,s,n,o,t,w,p,x;l=[];a=_(data).keys();w=_(data).values();m=b.margin_bottom;k=a.length>45?b.stroke_width_dense:b.stroke_width;j=0;for(f=w[0].length;j<
f;)d=b.line_colors[j],_.isUndefined(d)&&(d=u(b.line_colors[b.line_colors.length%j],Math.round(j/b.line_colors.length))),l[j]=this.path().attr({stroke:d,"stroke-width":k,"stroke-linejoin":"round"}),j++;d=this.set();j=[];f=[];a=a.length;i=0;for(x=[];i<a;){p=Math.round(c*i)+(b.label_offset+15);j[p]=[];f[p]=[];n=b.point_size;o=b.point_size_hover;k=i===0;a>45&&a<=90?(n=3,o=5):a>90&&(n=0,o=3);for(h=0;h<w[i].length;){t=w[i][h];s=Math.round(b.height-m-g*t);t<0&&(s=Math.round(b.height-m-g*0));if(a<=45)l[h][k?
"moveTo":"cplineTo"](p,s,10);else if(a<=90)l[h][k?"moveTo":"cplineTo"](p,s,4);else l[h][k?"moveTo":"cplineTo"](p,s,1);s=this.circle(p,s,n).attr({fill:b.line_colors[h],stroke:"#fff"});s.insertAfter(l[h]);j[p].push(s);f[p].push(t);h++}d.push(this.rect(p,0,c,b.height-m).attr({stroke:"none",fill:"#fff",opacity:0}));(function(a,c,d,f){return a.hover(function(){return _.each(c[d],function(a){return a.attr({r:o})})},function(){_.each(c[d],function(a){return a.attr({r:n})});return e("#tooltip").hide()}).mousemove(function(a){if(b.enable_tooltips)return q(a,
f[d])})})(d[d.length-1],j,p,f);x.push(i++)}return x};return{init:function(c,f,d){e.extend(!0,b,d);f=_.clone(f);b.trend===!0&&m(f,!0);if(b.verify_libraries){if(_.isUndefined(Date.prototype.strftime)||_.isUndefined(Date.prototype.setISO8601))throw"You must include the strftime.js file before executing Delorean.js";if(_.isUndefined(Raphael))throw"You must include the raphael.js file before executing Delorean.js";if(_.isUndefined(Raphael.el.lineTo))throw"You must include the raphael.path.methods.js file before executing Delorean.js";
}c=e(c);c.children().remove();return Raphael(c.get(0),b.width,b.height)},distill:function(b){return m(b)},render:function(){var c,e,d,a;d=_(data).keys();c=_(data).values();_.isArray(c[0])?a=_(_(c).flatten()).max():(a=_(c).max(),_.each(data,function(a,b){return data[b]=[a]}));c=(b.width-(b.label_offset+15))/d.length;e=(b.height-b.margin_bottom-b.margin_top)/a;r.drawXAxis(d,c);r.drawChart(c,e);return r.drawYAxis(a)}}};return e.delorean=function(b,e,g){var m;m=new f;m.init(b,e,g);return m}})(jQuery,
this,this.document)}).call(this);
