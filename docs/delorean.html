<!DOCTYPE html>  <html> <head>   <title>delorean.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="delorean.html">                 delorean.coffee               </a>                                           <a class="source" href="strftime.html">                 strftime.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               delorean.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>Delorean.js</strong> is an opintionated time-series graphing library which
focuses on balancing minimal amounts of readable code with aesthetics.
These two things combine to achieve, what I believe to be, the first
graphing library that is small, performant, and beautiful.</p>

<p>Developers no longer have to worry about how to make various size datasets
look ideal inside of their web applications. Delorean.js figures out the
optimal display criteria for the provided dataset, if its too large, it
will distill the data into a trended graph.</p>

<p>Trying to keep with the minimalist idea, Delorean.js depends on only two
external libraries: <a href="http://underscorejs.documentcloud.com">Underscore.js</a>
and <a href="http://jquery.com">jQuery</a>.</p>

<p>The <a href="http://github.com/jsmestad/delorean.js">source for Delorean.js</a> is
available on GitHub, and released under the Apache license.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Features</h2>

<h3>Data Distillation <em>(also known as Trending)</em></h3>

<p>Delorean.js allows users to pass a large dataset, 60 days worth of
hourly data for example, and graph it into a constrainted area of
your web application. When enabling distillation, Delorean.js
will take the 17,280 data points, calculate that it can only graph
42 points in a 700px wide graph, group them into groups of ~412
data points, calculate the average, and render the chart.</p>

<p>This allows web developers to use Javascript localStorage and only
fetch a given dataset once. When you resize the graph, just ask
delorean to recalculate the distillation.</p>

<h3>Outliers <em>(work in progress)</em></h3>

<p>Delorean.js has an outliers mode. This is similar to data distillation,
but it is used to isolate outliers (in our case we call an outlier,
anything that is two standard deviations from the mean). The reason
we do this is to eliminate the use-case where a single bad data point
will blow out the scale of the y-axis making the graph useless.</p>

<h3>No Tick Interval</h3>

<p>Leave behind the dreaded tick interval configuration. Delorean.js uses
the first two data points to calculate the interval of your graph. This
greatly simplifies and improves the perfomrance of the codebase, but
means that you better cleanse your dataset before passing it to the
client. Sorry, but we don't believe in giving developers saftey scissors.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Usage</h3>

<p>The JSON object for a single delorean.js line graph looks like:</p>

<pre><code>var stats = {
  "2011-10-08T09:30:00Z": 890234,
  "2010-12-31T09:30:00Z": 590234,
  "2010-12-30T09:30:00Z":   3024,
  "2010-12-29T09:30:00Z":  29134,
  "2010-12-28T09:30:00Z":  82372
}
</code></pre>

<p>For a multi-line graph, just make the values into an array:</p>

<pre><code>var stats = {
  "2011-10-08T09:30:00Z": [890234, 283749],
  "2010-12-31T09:30:00Z": [590234, 827],
  "2010-12-30T09:30:00Z": [3024, 0],
  "2010-12-29T09:30:00Z": [29134, 9827],
  "2010-12-28T09:30:00Z": [82372, 132]
}
</code></pre>

<p>Then initialize a new Delorean.js chart:</p>

<pre><code>var chart = $.delorean('#week_chart', stats, {});
chart.render();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Delorean = </span><span class="nf">(options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h1>Configuration Options</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <ul>
<li><p><strong>line_colors</strong> -- a set of colors in hex format that are used sequentially.
If more lines are requested than exist in the array, Delorean.js will
automatically ligthen and darken the original colors (see tintColor helper
to see how this works).
<em>Default:</em> <code>["#4da74d", "#afd8f8", "#edc240", "#cb4b4b", "#9440ed"]</code></p></li>
<li><p><strong>line_labels</strong> -- accepts an array of Strings that allow you to configure
labels for each of the lines passed into the array.
<em>Example:</em> <code>["Total", "Reads", "Writes", "Inserts"]</code> <br />
<em>Default:</em> <code>[]</code></p></li>
<li><p><strong>date_format</strong> -- configures the display of the dates across the x-axis.
See strftime.js for example usage. <br />
<em>Default:</em> <code>'%m/%d</code> meaning Jan 01 is 01/01</p></li>
<li><p><strong>height</strong> and <strong>width</strong> -- accepts an integer value to determine the size
of the resulting graph</p></li>
<li><p><strong>label_display_count</strong> -- accepts an integer value that sets the number of
y-axis labels to calculate and display.</p></li>
<li><p><strong>label_offset</strong> -- is a number of pixels to offset the x-axis labels, this
is similar to padding-left for the graph. This should not require any tweaking,
unless you change the label css.</p></li>
<li><p><strong>margin_left</strong> -- sets the left margin for the graph</p></li>
<li><p><strong>margin_bottom</strong> -- sets the bottom margin for the graph</p></li>
<li><p><strong>margin_top</strong> -- sets the top margin for the graph</p></li>
<li><p><strong>text_date</strong></p></li>
<li><p><strong>text_metric</strong></p></li>
<li><p><strong>trend</strong> -- enable or disable data trending. When enabled, delorean will
calculate the maximum amount of points that it can graph while maintaining
visual appeal and then group and average the points together. See distillData
for the code. <br />
<em>Default:</em> <code>false</code></p></li>
<li><p><strong>grid_color</strong> -- set the hex color for the x and y axis grid lines. <br />
<em>Default:</em> <code>#f5f5f5</code> which is a very light gray</p></li>
<li><p><strong>display<em>x</em>grid</strong> and <em>display_y_grid</em> -- are boolean flags that enable or
disable drawing axis grid lines. <br />
<em>Default:</em> <code>true</code></p></li>
<li><p><strong>stroke_width</strong></p></li>
<li><p><strong>stroke_width_dense</strong></p></li>
<li><p><strong>point_size</strong> -- the pixel size of each point in it's default state. Note, that
this functionality currently is overriden when trending is turned on, or you have
more than 45 data points. This will be fixed in an upcoming release. <br />
<em>Default:</em> <code>5</code></p></li>
<li><p><strong>point_size_hover</strong> -- the pixel size of points when they are hovered over. See
note in the point_size definition, this variable is bound to this same constraint. <br />
<em>Default:</em> <code>7</code></p></li>
<li><p><strong>enable_tooltips</strong> -- is a boolean flag to enable or disable tooltips. See
tooltip documentation below for more information. <br />
<em>Default:</em> <code>false</code></p></li>
<li><p><strong>verify_libraries</strong> -- is a boolean flag to enable crude dependency checking
at runtime. <br />
<em>Default:</em> <code>true</code></p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">options =</span>
    <span class="nv">line_colors: </span><span class="p">[</span> <span class="s2">&quot;#4da74d&quot;</span><span class="p">,</span> <span class="s2">&quot;#afd8f8&quot;</span><span class="p">,</span> <span class="s2">&quot;#edc240&quot;</span><span class="p">,</span> <span class="s2">&quot;#cb4b4b&quot;</span><span class="p">,</span> <span class="s2">&quot;#9440ed&quot;</span> <span class="p">]</span>

    <span class="nv">line_labels: </span><span class="p">[]</span>

    <span class="nv">date_format: </span><span class="s2">&quot;%m/%d&quot;</span>

    <span class="nv">height: </span><span class="mi">200</span>
    <span class="nv">width: </span><span class="mi">700</span>

    <span class="nv">label_display_count: </span><span class="mi">3</span>
    <span class="nv">label_offset: </span><span class="mi">15</span>

    <span class="nv">margin_left: </span><span class="mi">5</span>
    <span class="nv">margin_bottom: </span><span class="mi">5</span>
    <span class="nv">margin_top: </span><span class="mi">5</span>

    <span class="nv">text_date:</span>
      <span class="nv">fill: </span><span class="s2">&quot;#999&quot;</span>
      <span class="s2">&quot;font-size&quot;</span><span class="o">:</span> <span class="s2">&quot;10px&quot;</span>

    <span class="nv">text_metric:</span>
      <span class="s2">&quot;font-size&quot;</span><span class="o">:</span> <span class="s2">&quot;13px&quot;</span>
      <span class="s2">&quot;font-family&quot;</span><span class="o">:</span> <span class="s2">&quot;Arial, san-serif&quot;</span>

    <span class="nv">trend: </span><span class="kc">false</span>
    <span class="nv">grid_color: </span><span class="s2">&quot;#f5f5f5&quot;</span>
    <span class="nv">display_x_grid: </span><span class="kc">true</span>
    <span class="nv">display_y_grid: </span><span class="kc">true</span>
    <span class="nv">stroke_width: </span><span class="mi">4</span>
    <span class="nv">stroke_width_dense: </span><span class="mi">2</span>
    <span class="nv">point_size: </span><span class="mi">5</span>
    <span class="nv">point_size_hover: </span><span class="mi">7</span>
    <span class="nv">enable_tooltips: </span><span class="kc">false</span>
    <span class="nv">verify_libraries: </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Helper Functions</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>The functions below are all private, meaning they cannot be
invoked directly. They are below for documentation purposes
only.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>Log</h3>

<p>Wraps the log function allowing <em>log</em> statements to be left
in production code without causing errors.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">log = </span><span class="o">-&gt;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">console</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Array</span><span class="o">::</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>Mean</h3>

<p>Calculates the mean of an Array of numbers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mean = </span><span class="nf">(numbers) -&gt;</span>
    <span class="nv">total = </span><span class="mi">0</span>

    <span class="nv">i = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">numbers</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">total</span> <span class="o">+=</span> <span class="nx">numbers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">total</span> <span class="err">/ numbers.length</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>Median</h3>

<p>Calculates the median of an Array of numbers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">median = </span><span class="nf">(numbers) -&gt;</span>
    <span class="nv">median = </span><span class="mi">0</span>
    <span class="nv">numsLen = </span><span class="nx">numbers</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">numbers</span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">numsLen</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nv">median = </span><span class="p">(</span><span class="nx">numbers</span><span class="p">[</span><span class="nx">numsLen</span> <span class="sr">/ 2 - 1] + numbers[numsLen / 2]) /</span> <span class="mi">2</span>
    <span class="k">else</span>
      <span class="nv">median = </span><span class="nx">numbers</span><span class="p">[(</span><span class="nx">numsLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="nx">median</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3>Mode</h3>

<p>Calculates the mode of an Array of numbers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mode = </span><span class="nf">(numbers) -&gt;</span>
    <span class="nv">modes = </span><span class="p">[]</span>
    <span class="nv">count = </span><span class="p">[]</span>
    <span class="nv">maxIndex = </span><span class="mi">0</span>
    <span class="nv">i = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">numbers</span><span class="p">.</span><span class="nx">length</span>
      <span class="nv">number = </span><span class="nx">numbers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="nx">count</span><span class="p">[</span><span class="nx">number</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">count</span><span class="p">[</span><span class="nx">number</span><span class="p">]</span> <span class="o">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="nv">maxIndex = </span><span class="nx">count</span><span class="p">[</span><span class="nx">number</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">count</span><span class="p">[</span><span class="nx">number</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">maxIndex</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">count</span>
      <span class="nx">modes</span><span class="p">.</span><span class="nx">push</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">count</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">maxIndex</span>  <span class="k">if</span> <span class="nx">count</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="nx">modes</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Range</h3>

<p>Calculates the range of an Array of numbers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">range = </span><span class="nf">(numbers) -&gt;</span>
    <span class="nx">numbers</span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span>
    <span class="p">[</span> <span class="nx">numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">numbers</span><span class="p">[</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h3>parseDate</h3>

<p>Helper function that ensures every browser supports the Date ISO8601 standard.
The obvious one that does not is Safari.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">parseDate = </span><span class="nf">(date) -&gt;</span>
    <span class="nv">d = </span><span class="p">(</span><span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isDate</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="k">then</span> <span class="nx">date</span> <span class="k">else</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
      <span class="nx">log</span> <span class="s2">&quot;ISO 8601 Date constructor not supported in this browser.&quot;</span>
      <span class="nv">d = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
      <span class="nx">d</span><span class="p">.</span><span class="nx">setISO8601</span> <span class="nx">date</span>
    <span class="nx">d</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>calculateLabelWidth</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">calculateLabelWidth = </span><span class="nf">(date) -&gt;</span>
    <span class="nv">d = </span><span class="nx">parseDate</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">strftime</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">date_format</span><span class="p">)</span>
    <span class="nv">texty = </span><span class="nx">r</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">d</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">text_date</span><span class="p">)</span>
    <span class="nv">label_width = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">texty</span><span class="p">.</span><span class="nx">getBBox</span><span class="p">().</span><span class="nx">width</span> <span class="o">+</span> <span class="mf">22.5</span><span class="p">)</span>
    <span class="nx">texty</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
    <span class="nx">label_width</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>displayValue</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">displayValue = </span><span class="nf">(value, precision) -&gt;</span>
    <span class="k">if</span> <span class="nx">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">value</span> <span class="o">&lt;</span> <span class="mi">1000</span>
      <span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">value</span> <span class="o">&gt;=</span> <span class="mi">1000</span> <span class="o">and</span> <span class="nx">value</span> <span class="o">&lt;</span> <span class="mi">1000000</span>
      <span class="p">(</span><span class="nx">value</span> <span class="err">/ 1000).toFixed(precision) + &quot;K&quot;</span>
    <span class="k">else</span>
      <span class="p">(</span><span class="nx">value</span> <span class="err">/ 1000000).toFixed(precision) + &quot;M&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3>tooltip</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tooltip = </span><span class="nf">(event, values) -&gt;</span>
    <span class="nx">unless</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#tooltip&quot;</span><span class="p">).</span><span class="nx">length</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">append</span> <span class="s2">&quot;&lt;div id=\&quot;tooltip\&quot;&gt;&lt;div id=\&quot;tooltip_inner\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">values</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&lt;/div&gt;&quot;</span>
    <span class="k">else</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#tooltip_inner&quot;</span><span class="p">).</span><span class="nx">html</span> <span class="nx">values</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">)</span>
    <span class="nv">svg = </span><span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span>
    <span class="nv">svg_x = </span><span class="nx">svg</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">()</span>
    <span class="nv">svg_y = </span><span class="nx">svg</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()</span>
    <span class="nv">tooltip = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#tooltip&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span>
    <span class="nv">tooltip_inner = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#tooltip_inner&quot;</span><span class="p">)</span>
    <span class="nv">event_x = </span><span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span>
    <span class="nv">event_y = </span><span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span>
    <span class="nv">tooltip_x = </span><span class="nx">tooltip</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">()</span>
    <span class="nv">tooltip_y = </span><span class="nx">tooltip</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()</span>
    <span class="nx">tooltip</span><span class="p">.</span><span class="nx">css</span>
      <span class="nv">top: </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">event_y</span> <span class="o">+</span> <span class="nx">tooltip_y</span> <span class="o">&gt;</span> <span class="nx">svg_y</span><span class="p">)</span> <span class="k">then</span> <span class="nx">event_y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">tooltip_y</span> <span class="err">/ 2) else event_y)</span>
      <span class="nv">left: </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">event_x</span> <span class="o">+</span> <span class="nx">tooltip_x</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">&gt;</span> <span class="nx">svg_x</span><span class="p">)</span> <span class="k">then</span> <span class="nx">event_x</span> <span class="o">-</span> <span class="nx">tooltip_x</span> <span class="o">-</span> <span class="mi">15</span> <span class="k">else</span> <span class="nx">event_x</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>tintColor</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tintColor = </span><span class="nf">(color, value) -&gt;</span>
    <span class="nv">color = </span><span class="nx">color</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nx">color</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">if</span> <span class="nx">color</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">6</span>
    <span class="nv">rgb = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="nv">red = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(((</span><span class="nx">rgb</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
    <span class="nv">green = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(((</span><span class="nx">rgb</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
    <span class="nv">blue = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">((</span><span class="nx">rgb</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>

    <span class="nv">red = </span><span class="k">if</span> <span class="nx">red</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="k">then</span> <span class="nx">red</span> <span class="o">-</span> <span class="p">(</span><span class="nx">red</span> <span class="o">-</span> <span class="mi">255</span><span class="p">)</span> <span class="k">else</span> <span class="nx">red</span>
    <span class="nv">green = </span><span class="k">if</span> <span class="nx">green</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="k">then</span> <span class="nx">green</span> <span class="o">-</span> <span class="p">(</span><span class="nx">green</span> <span class="o">-</span> <span class="mi">255</span><span class="p">)</span> <span class="k">else</span> <span class="nx">green</span>
    <span class="nv">blue = </span><span class="k">if</span> <span class="nx">blue</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="k">then</span> <span class="nx">blue</span> <span class="o">-</span> <span class="p">(</span><span class="nx">blue</span> <span class="o">-</span> <span class="mi">255</span><span class="p">)</span> <span class="k">else</span> <span class="nx">blue</span>

    <span class="nv">red = </span><span class="k">if</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">red</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">red</span><span class="p">))</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="nx">red</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="nx">red</span><span class="p">)</span>
    <span class="nv">green = </span><span class="k">if</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">green</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">green</span><span class="p">))</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="nx">green</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="nx">green</span><span class="p">)</span>
    <span class="nv">blue = </span><span class="k">if</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">blue</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">blue</span><span class="p">))</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="nx">blue</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="nx">blue</span><span class="p">)</span>
    <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">red</span><span class="p">.</span><span class="nx">toPaddedString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nx">green</span><span class="p">.</span><span class="nx">toPaddedString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nx">blue</span><span class="p">.</span><span class="nx">toPaddedString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>selectColor</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">selectColor = </span><span class="nf">(index) -&gt;</span>
    <span class="nv">c = </span><span class="nx">options</span><span class="p">.</span><span class="nx">line_colors</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
      <span class="nv">v = </span><span class="p">(</span><span class="nx">index</span> <span class="o">%</span> <span class="nx">options</span><span class="p">.</span><span class="nx">line_colors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
      <span class="nv">c = </span><span class="nx">options</span><span class="p">.</span><span class="nx">line_colors</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span>
      <span class="nv">c = </span><span class="nx">tintColor</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">index</span> <span class="err">/ options.line_colors.length)+50)</span>
    <span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h3>distillData</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">distillData = </span><span class="nf">(data, force) -&gt;</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNull</span><span class="p">(</span><span class="nx">distilled_data</span><span class="p">)</span> <span class="o">or</span> <span class="nx">force</span> <span class="o">==</span> <span class="kc">true</span>
      <span class="nv">distilled_data = </span><span class="p">{}</span>
      <span class="nv">tmp_data = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="nv">dates = </span><span class="nx">_</span><span class="p">(</span><span class="nx">tmp_data</span><span class="p">).</span><span class="nx">keys</span><span class="p">()</span>
      <span class="nv">max_points = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="err">/ 17)</span>
      <span class="nv">every_x = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">dates</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">max_points</span><span class="p">)</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">dates</span><span class="p">.</span><span class="nx">length</span> <span class="err">/ max_points) else 1)</span>
      <span class="nv">date_groups = </span><span class="p">[]</span>
      <span class="nv">normalized_data = </span><span class="p">{}</span>
      <span class="nv">point_num = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">every_x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="nx">dates</span><span class="p">.</span><span class="nx">length</span> <span class="k">else</span> <span class="nx">max_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

      <span class="nx">_</span><span class="p">(</span><span class="nx">point_num</span><span class="p">).</span><span class="nx">times</span> <span class="nf">(i) -&gt;</span>
        <span class="nx">date_groups</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">dates</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">every_x</span><span class="p">)</span>

      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">date_groups</span><span class="p">,</span> <span class="nf">(date_group) -&gt;</span>
        <span class="nv">values = </span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">date_group</span><span class="p">,</span> <span class="nf">(d) -&gt;</span>
          <span class="nx">tmp_data</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="nv">avg = </span><span class="p">[]</span>
          <span class="nx">_</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">).</span><span class="nx">times</span> <span class="nf">(i) -&gt;</span>
            <span class="nv">set = </span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="nf">(v) -&gt;</span>
              <span class="nx">v</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="nx">avg</span><span class="p">.</span><span class="nx">push</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">_</span><span class="p">(</span><span class="nx">set</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="nf">(sum, n) -&gt;</span>
              <span class="nx">sum</span> <span class="o">+</span> <span class="nx">n</span>
            <span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nx">set</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="nv">avg = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">_</span><span class="p">(</span><span class="nx">values</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="nf">(sum, n) -&gt;</span>
            <span class="nx">sum</span> <span class="o">+</span> <span class="nx">n</span>
          <span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
        <span class="nv">display_date = </span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">date_group</span><span class="p">,</span> <span class="nf">(d) -&gt;</span>
          <span class="nx">parseDate</span> <span class="nx">d</span>
        <span class="p">)</span>
        <span class="nv">starting_date = </span><span class="nx">_</span><span class="p">(</span><span class="nx">display_date</span><span class="p">).</span><span class="nx">chain</span><span class="p">().</span><span class="nx">sort</span><span class="p">(</span><span class="nf">(a, b) -&gt;</span>
          <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span>
          <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">b</span>
          <span class="mi">0</span>
        <span class="p">).</span><span class="nx">head</span><span class="p">().</span><span class="nx">value</span><span class="p">()</span>
        <span class="nx">distilled_data</span><span class="p">[</span><span class="nx">starting_date</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">()]</span> <span class="o">=</span> <span class="nx">avg</span>
    <span class="nx">distilled_data</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h3>drawXAxis</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Raphael.fn.drawXAxis = </span><span class="nf">(dates, X) -&gt;</span>
    <span class="nv">dates_length = </span><span class="nx">dates</span><span class="p">.</span><span class="nx">length</span>
    <span class="nv">num_to_skip = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">dates_length</span> <span class="err">/ 11)</span>
    <span class="nv">y_position = </span><span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">8</span>
    <span class="nv">label_width = </span><span class="nx">calculateLabelWidth</span><span class="p">(</span><span class="nx">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nv">total_possible = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="err">/ label_width)</span>
    <span class="nv">every_x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">dates_length</span> <span class="err">/ total_possible)</span>
    <span class="k">if</span> <span class="nx">every_x</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nv">date_labels = </span><span class="nx">dates</span>
    <span class="k">else</span>
      <span class="nv">date_labels = </span><span class="nx">_</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">dates</span><span class="p">,</span> <span class="nf">(d, index) -&gt;</span>
        <span class="nx">index</span> <span class="o">%</span> <span class="nx">every_x</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="p">)</span>
    <span class="nv">i = </span><span class="nx">date_labels</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">while</span> <span class="nx">i</span><span class="o">--</span>
      <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">X</span> <span class="o">*</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">dates</span><span class="p">,</span> <span class="nx">date_labels</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="kc">true</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">label_offset</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
      <span class="nv">date = </span><span class="nx">parseDate</span><span class="p">(</span><span class="nx">date_labels</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">strftime</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">date_format</span><span class="p">)</span>
      <span class="nx">@text</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y_position</span><span class="p">,</span> <span class="nx">date</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">text_date</span><span class="p">).</span><span class="nx">toBack</span><span class="p">()</span>
      <span class="nx">@path</span><span class="p">([</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y_position</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]).</span><span class="nx">attr</span><span class="p">(</span><span class="nv">stroke: </span><span class="nx">options</span><span class="p">.</span><span class="nx">grid_color</span><span class="p">).</span><span class="nx">toBack</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">display_x_grid</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>drawYAxis</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Raphael.fn.drawYAxis = </span><span class="nf">(max) -&gt;</span>
    <span class="nv">display = </span><span class="nx">options</span><span class="p">.</span><span class="nx">label_display_count</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nv">max_more = </span><span class="nx">max</span> <span class="o">*</span> <span class="mf">1.33</span>
    <span class="nv">max_less = </span><span class="nx">max</span> <span class="err">/ display</span>
    <span class="nv">offset_x = </span><span class="nx">options</span><span class="p">.</span><span class="nx">label_offset</span>
    <span class="nv">y_spacing = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">options</span><span class="p">.</span><span class="nx">margin_bottom</span> <span class="o">-</span> <span class="nx">options</span><span class="p">.</span><span class="nx">margin_top</span><span class="p">)</span> <span class="o">/</span> <span class="nx">display</span><span class="p">)</span>
    <span class="nv">offset_y = </span><span class="nx">y_spacing</span> <span class="o">*</span> <span class="nx">display</span>
    <span class="nv">scale = </span><span class="mi">0</span>

    <span class="k">while</span> <span class="nx">scale</span> <span class="o">&lt;</span> <span class="nx">max_more</span>
      <span class="k">if</span> <span class="nx">display</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">scale</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">display_y_grid</span>
          <span class="nv">j = </span><span class="mi">0</span>
          <span class="k">while</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="mi">1</span>
            <span class="nv">t = </span><span class="p">(</span><span class="k">if</span> <span class="nx">j</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">then</span> <span class="nx">offset_y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y_spacing</span> <span class="err">/ 2) else offset_y)</span>
            <span class="nx">@path</span><span class="p">([</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="nx">offset_x</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">]).</span><span class="nx">attr</span><span class="p">(</span><span class="nv">stroke: </span><span class="nx">options</span><span class="p">.</span><span class="nx">grid_color</span><span class="p">).</span><span class="nx">toBack</span><span class="p">()</span>
            <span class="nx">@path</span><span class="p">([</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="nx">offset_x</span><span class="p">,</span> <span class="nx">offset_y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">y_spacing</span> <span class="err">/ 2), &quot;H&quot;, options.width - 5 ]).attr(stroke: options.grid_color).toBack()  if display == 1 and j == 1</span>
            <span class="nx">j</span><span class="o">++</span>
        <span class="nx">@text</span><span class="p">(</span><span class="nx">offset_x</span><span class="p">,</span> <span class="nx">offset_y</span><span class="p">,</span> <span class="nx">displayValue</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">scale</span><span class="p">),</span> <span class="mi">0</span><span class="p">)).</span><span class="nx">attr</span><span class="p">(</span>
          <span class="nv">fill: </span><span class="nx">options</span><span class="p">.</span><span class="nx">text_date</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">]</span>
          <span class="s2">&quot;font-weight&quot;</span><span class="o">:</span> <span class="s2">&quot;bold&quot;</span>
        <span class="p">).</span><span class="nx">toFront</span><span class="p">()</span>
      <span class="nx">offset_y</span> <span class="o">-=</span> <span class="nx">y_spacing</span>
      <span class="nx">display</span><span class="o">--</span>
      <span class="nx">scale</span> <span class="o">+=</span> <span class="nx">max_less</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h3>drawChart</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Raphael.fn.drawChart = </span><span class="nf">(X, Y) -&gt;</span>
    <span class="nv">line_paths = </span><span class="p">[]</span>
    <span class="nv">dates = </span><span class="nx">_</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">keys</span><span class="p">()</span>
    <span class="nv">values = </span><span class="nx">_</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">values</span><span class="p">()</span>
    <span class="nv">margin_left = </span><span class="nx">options</span><span class="p">.</span><span class="nx">margin_left</span>
    <span class="nv">margin_bottom = </span><span class="nx">options</span><span class="p">.</span><span class="nx">margin_bottom</span>
    <span class="nv">margin_top = </span><span class="nx">options</span><span class="p">.</span><span class="nx">margin_top</span>
    <span class="nv">stroke_width = </span><span class="p">(</span><span class="k">if</span> <span class="nx">dates</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">45</span> <span class="k">then</span> <span class="nx">options</span><span class="p">.</span><span class="nx">stroke_width_dense</span> <span class="k">else</span> <span class="nx">options</span><span class="p">.</span><span class="nx">stroke_width</span><span class="p">)</span>
    <span class="nv">k = </span><span class="mi">0</span>
    <span class="nv">kk = </span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span>

    <span class="k">while</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="nx">kk</span>
      <span class="nx">line_paths</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@path</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span>
        <span class="nv">stroke: </span><span class="nx">selectColor</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
        <span class="s2">&quot;stroke-width&quot;</span><span class="o">:</span> <span class="nx">stroke_width</span>
        <span class="s2">&quot;stroke-linejoin&quot;</span><span class="o">:</span> <span class="s2">&quot;round&quot;</span>
      <span class="p">)</span>
      <span class="nx">k</span><span class="o">++</span>
    <span class="nv">layer = </span><span class="nx">@set</span><span class="p">()</span>
    <span class="nv">point_array = </span><span class="p">[]</span>
    <span class="nv">values_array = </span><span class="p">[]</span>
    <span class="nv">tooltip_visible = </span><span class="kc">false</span>
    <span class="nv">leave_timer = </span><span class="kc">null</span>
    <span class="nv">dates_length = </span><span class="nx">dates</span><span class="p">.</span><span class="nx">length</span>
    <span class="nv">i = </span><span class="mi">0</span>

    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">dates_length</span>
      <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">X</span> <span class="o">*</span> <span class="nx">i</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">label_offset</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
      <span class="nx">point_array</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="nx">values_array</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="nv">stroke_color = </span><span class="s2">&quot;#fff&quot;</span>
      <span class="nv">point_size = </span><span class="nx">options</span><span class="p">.</span><span class="nx">point_size</span>
      <span class="nv">point_size_hover = </span><span class="nx">options</span><span class="p">.</span><span class="nx">point_size_hover</span>
      <span class="nv">first_point = </span><span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="nx">dates_length</span> <span class="o">&gt;</span> <span class="mi">45</span> <span class="o">and</span> <span class="nx">dates_length</span> <span class="o">&lt;=</span> <span class="mi">90</span>
        <span class="nv">point_size = </span><span class="mi">3</span>
        <span class="nv">point_size_hover = </span><span class="mi">5</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">dates_length</span> <span class="o">&gt;</span> <span class="mi">90</span>
        <span class="nv">point_size = </span><span class="mi">0</span>
        <span class="nv">point_size_hover = </span><span class="mi">3</span>
      <span class="nv">j = </span><span class="mi">0</span>

      <span class="k">while</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span>
        <span class="nv">value = </span><span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span>
        <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">margin_bottom</span> <span class="o">-</span> <span class="nx">Y</span> <span class="o">*</span> <span class="nx">value</span><span class="p">)</span>
        <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">margin_bottom</span> <span class="o">-</span> <span class="nx">Y</span> <span class="o">*</span> <span class="mi">0</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">value</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nx">dates_length</span> <span class="o">&lt;=</span> <span class="mi">45</span>
          <span class="nx">line_paths</span><span class="p">[</span><span class="nx">j</span><span class="p">][(</span><span class="k">if</span> <span class="nx">first_point</span> <span class="k">then</span> <span class="s2">&quot;moveTo&quot;</span> <span class="k">else</span> <span class="s2">&quot;cplineTo&quot;</span><span class="p">)]</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">10</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">dates_length</span> <span class="o">&lt;=</span> <span class="mi">90</span>
          <span class="nx">line_paths</span><span class="p">[</span><span class="nx">j</span><span class="p">][(</span><span class="k">if</span> <span class="nx">first_point</span> <span class="k">then</span> <span class="s2">&quot;moveTo&quot;</span> <span class="k">else</span> <span class="s2">&quot;cplineTo&quot;</span><span class="p">)]</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">4</span>
        <span class="k">else</span>
          <span class="nx">line_paths</span><span class="p">[</span><span class="nx">j</span><span class="p">][(</span><span class="k">if</span> <span class="nx">first_point</span> <span class="k">then</span> <span class="s2">&quot;moveTo&quot;</span> <span class="k">else</span> <span class="s2">&quot;cplineTo&quot;</span><span class="p">)]</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">1</span>
        <span class="nv">point = </span><span class="nx">@circle</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">point_size</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span>
          <span class="nv">fill: </span><span class="nx">options</span><span class="p">.</span><span class="nx">line_colors</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
          <span class="nv">stroke: </span><span class="nx">stroke_color</span>
        <span class="p">)</span>
        <span class="nx">point</span><span class="p">.</span><span class="nx">insertAfter</span> <span class="nx">line_paths</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
        <span class="nx">point_array</span><span class="p">[</span><span class="nx">x</span><span class="p">].</span><span class="nx">push</span> <span class="nx">point</span>
        <span class="nx">values_array</span><span class="p">[</span><span class="nx">x</span><span class="p">].</span><span class="nx">push</span> <span class="nx">value</span>
        <span class="nx">j</span><span class="o">++</span>
      <span class="nx">layer</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@rect</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">X</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">margin_bottom</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span>
        <span class="nv">stroke: </span><span class="s2">&quot;none&quot;</span>
        <span class="nv">fill: </span><span class="s2">&quot;#fff&quot;</span>
        <span class="nv">opacity: </span><span class="mi">0</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="nf">(rect, points, x, values) -&gt;</span>
        <span class="nx">rect</span><span class="p">.</span><span class="nx">hover</span><span class="p">(</span><span class="o">-&gt;</span>
          <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">points</span><span class="p">[</span><span class="nx">x</span><span class="p">],</span> <span class="nf">(point) -&gt;</span>
            <span class="nx">point</span><span class="p">.</span><span class="nx">attr</span> <span class="nv">r: </span><span class="nx">point_size_hover</span>
        <span class="p">,</span> <span class="o">-&gt;</span>
          <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">points</span><span class="p">[</span><span class="nx">x</span><span class="p">],</span> <span class="nf">(point) -&gt;</span>
            <span class="nx">point</span><span class="p">.</span><span class="nx">attr</span> <span class="nv">r: </span><span class="nx">point_size</span>

          <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#tooltip&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
        <span class="p">).</span><span class="nx">mousemove</span> <span class="nf">(event) -&gt;</span>
          <span class="nx">tooltip</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">values</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">enable_tooltips</span>
      <span class="p">)</span> <span class="nx">layer</span><span class="p">[</span><span class="nx">layer</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="nx">point_array</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">values_array</span>
      <span class="nx">i</span><span class="o">++</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h1>Instance Methods</h1>

<p>These are methods that you can invoke on any Delorean.js instance</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3>init</h3>

<p>This method is implicitly invoked. You shouldn't ever need to call
this directly. See <em>$.delorean()</em> for details on how this is used.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">init: </span><span class="nf">(target_, data_, options_) -&gt;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">options_</span>
    <span class="nv">raw_data = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">data_</span><span class="p">)</span>
    <span class="nv">data = </span><span class="p">(</span><span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">trend</span> <span class="o">==</span> <span class="kc">true</span> <span class="k">then</span> <span class="nx">distillData</span><span class="p">(</span><span class="nx">raw_data</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="k">else</span> <span class="nx">raw_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">verify_libraries</span>
      <span class="k">throw</span> <span class="s2">&quot;You must include the strftime.js file before executing Delorean.js&quot;</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nb">Date</span><span class="o">::</span><span class="nx">strftime</span><span class="p">)</span> <span class="o">or</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nb">Date</span><span class="o">::</span><span class="nx">setISO8601</span><span class="p">)</span>
      <span class="k">throw</span> <span class="s2">&quot;You must include the raphael.js file before executing Delorean.js&quot;</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">Raphael</span><span class="p">)</span>
      <span class="k">throw</span> <span class="s2">&quot;You must include the raphael.path.methods.js file before executing Delorean.js&quot;</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">Raphael</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">)</span>
    <span class="nv">chart = </span><span class="nx">$</span><span class="p">(</span><span class="nx">target_</span><span class="p">)</span>
    <span class="nx">chart</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">remove</span><span class="p">()</span>
    <span class="nv">r = </span><span class="nx">Raphael</span><span class="p">(</span><span class="nx">chart</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">options</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h3>distill</h3>

<p>Calling this will cause the dataset utilized by the chart to be distilled
down to a trended dataset. This allows you to pass more data points than
displayable pixels.</p>

<p>This method takes one argument, force, which is a boolean value telling
the <em>distillData</em> function to force a data refresh or not.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">distill: </span><span class="nf">(force) -&gt;</span>
    <span class="nx">distillData</span> <span class="nx">force</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h3>render</h3>

<p>This will draw the actual chart. If not invoked, the chart will never be
inserted into the DOM.</p>

<p>Currently calling render multiple times will cause the graph to re-render,
but this has not been extensively tested.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render: </span><span class="o">-&gt;</span>
    <span class="nv">dates = </span><span class="nx">_</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">keys</span><span class="p">()</span>
    <span class="nv">values = </span><span class="nx">_</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">values</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nv">max = </span><span class="nx">_</span><span class="p">(</span><span class="nx">_</span><span class="p">(</span><span class="nx">values</span><span class="p">).</span><span class="nx">flatten</span><span class="p">()).</span><span class="nx">max</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nv">max = </span><span class="nx">_</span><span class="p">(</span><span class="nx">values</span><span class="p">).</span><span class="nx">max</span><span class="p">()</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">data</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">value</span><span class="p">]</span>
    <span class="nv">X = </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">label_offset</span> <span class="o">+</span> <span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="nx">dates</span><span class="p">.</span><span class="nx">length</span>
    <span class="nv">Y = </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">options</span><span class="p">.</span><span class="nx">margin_bottom</span> <span class="o">-</span> <span class="nx">options</span><span class="p">.</span><span class="nx">margin_top</span><span class="p">)</span> <span class="o">/</span> <span class="nx">max</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">drawXAxis</span> <span class="nx">dates</span><span class="p">,</span> <span class="nx">X</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">drawChart</span> <span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">drawYAxis</span> <span class="nx">max</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h1>Initializer</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h2>$.delorean</h2>

<p>This will initialize a new Delorean.js chart.</p>

<pre><code>var chart = $.delorean(#chart_id, {...data...}, {...options...});
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$.delorean = </span><span class="nf">(target, data, options) -&gt;</span>
  <span class="nv">delorean = </span><span class="k">new</span> <span class="nx">Delorean</span><span class="p">()</span>
  <span class="nx">delorean</span><span class="p">.</span><span class="nx">init</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span>
  <span class="nx">delorean</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 